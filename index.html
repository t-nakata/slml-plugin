<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SLML Renderer Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .editor-container {
      display: flex;
      gap: 20px;
      height: 720px;
    }
    .editor, .preview {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      overflow: auto;
    }
    .editor {
      font-family: monospace;
      white-space: pre-wrap;
    }
    textarea {
      width: 100%;
      height: 100%;
      border: none;
      resize: none;
      font-family: monospace;
      font-size: 14px;
    }
    .preview {
      background-color: #f9f9f9;
    }
    .button-container {
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #2980b9;
    }
    .example-container {
      margin-top: 20px;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }
    .example {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 10px;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SLML Renderer Demo</h1>

    <div class="editor-container">
      <div class="editor">
        <textarea id="markdown-input" placeholder="Enter Markdown with SLML code blocks here..."></textarea>
      </div>
      <div class="preview" id="preview">
        <!-- Rendered output will appear here -->
      </div>
    </div>

    <div class="button-container">
      <button id="render-btn">Render</button>
      <button id="load-example-btn">Load Example</button>
      <button id="clear-btn">Clear</button>
    </div>

    <div class="example-container">
      <h2>Example SLML Code</h2>
      <div class="example">```slml
# Flutter UI
screen:
  title: "Flutter UI"
  size: 393, 852
  backgroundColor: #f5f5f5
appbar:
  title: "My Flutter App"
  backgroundColor: #2196F3
input:
  label: "Search..."
  align: center
  padding: 20
  backgroundColor: #ffffff
margin:
  width: 300
  height: 30
image:
  url: "https://example.com/image.jpg"
  align: center
  width: 200
  height: 150
button:
  label: "Submit"
  align: center
  backgroundColor: #4CAF50
floatingActionButton:
  label: "+"
bottomNavigationBar:
  backgroundColor: #ffffff
  children:
    - bottomNavigationItem:
        label: "Home"
        icon: üè†
        active: true
    - bottomNavigationItem:
        label: "Search"
        icon: üîç
    - bottomNavigationItem:
        label: "Profile"
        icon: üë§
    - bottomNavigationItem:
        label: "Settings"
        icon: ‚öôÔ∏è
```</div>
      <p>Copy this example into the editor and click "Render" to see the SVG output.</p>
      <p>Features:</p>
      <ul>
        <li>Screen size specification: <code>size: 393, 852</code></li>
        <li>Screen background color: <code>backgroundColor: #f5f5f5</code></li>
        <li>Element alignment: <code>align: left|center|right</code></li>
        <li>Element padding: <code>padding: 20</code></li>
        <li>Element background color: <code>backgroundColor: #ffffff</code></li>
        <li>Flutter UI components: appbar, bottomNavigationBar, floatingActionButton</li>
        <li>Margin element: <code>margin: width: 300, height: 30</code> for adding customizable space</li>
        <li>Image element: <code>image: url: "url"</code> for displaying images</li>
        <li>BottomNavigationBar with items using children property and indentation</li>
        <li>BottomNavigationItem with icons: <code>icon: üè†, active: true|false</code></li>
      </ul>
    </div>
  </div>

  <script type="module">
    // Import the parser and renderer
    import { processMarkdown } from './parser.js';
    import { renderSLMLToSVG, replaceSLMLWithSVG } from './renderer.js';

    // DOM elements
    const markdownInput = document.getElementById('markdown-input');
    const preview = document.getElementById('preview');
    const renderBtn = document.getElementById('render-btn');
    const loadExampleBtn = document.getElementById('load-example-btn');
    const clearBtn = document.getElementById('clear-btn');

    // Example SLML code
    const exampleMarkdown = `# Flutter UI Components

Below is a Flutter UI screen with custom styling:

\`\`\`slml
# Flutter UI
screen:
  title: "Flutter UI"
  size: 393, 852
  backgroundColor: #f5f5f5
appbar:
  title: "My Flutter App"
  backgroundColor: #2196F3
input:
  label: "Search..."
  align: center
  padding: 20
  backgroundColor: #ffffff
margin:
  width: 300
  height: 30
image:
  url: "https://example.com/image.jpg"
  align: center
  width: 200
  height: 150
button:
  label: "Submit"
  align: center
  backgroundColor: #4CAF50
floatingActionButton:
  label: "+"
bottomNavigationBar:
  backgroundColor: #ffffff
  children:
    - bottomNavigationItem:
        label: "Home"
        icon: üè†
        active: true
    - bottomNavigationItem:
        label: "Search"
        icon: üîç
    - bottomNavigationItem:
        label: "Profile"
        icon: üë§
    - bottomNavigationItem:
        label: "Settings"
        icon: ‚öôÔ∏è
\`\`\`

This is rendered using the SLML plugin with the following features:
- Screen size specification: \`size: 393, 852\`
- Screen background color: \`backgroundColor: #f5f5f5\`
- Element alignment: \`align: left|center|right\`
- Element padding: \`padding: 20\`
- Element background color: \`backgroundColor: #color\`
- Flutter UI components: appbar, bottomNavigationBar, floatingActionButton
- Margin element: \`margin: width: 300, height: 30\` for adding customizable space
- Image element: \`image: url: "url"\` for displaying images
- BottomNavigationBar with items using children property and indentation
- BottomNavigationItem with icons: \`icon: üè†, active: true|false\`
`;

    // Render the markdown with SLML
    function renderMarkdown() {
      const markdown = markdownInput.value;

      try {
        // Process the markdown to find and render SLML blocks
        // Use a scale factor of 0.6 to make the preview smaller (300px width for a 500px screen)
        const processedMarkdown = replaceSLMLWithSVG(markdown, 0.6);

        // Display the processed markdown
        preview.innerHTML = processedMarkdown;
      } catch (error) {
        console.error('Error rendering markdown:', error);
        preview.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
      }
    }

    // Event listeners
    renderBtn.addEventListener('click', renderMarkdown);

    loadExampleBtn.addEventListener('click', () => {
      markdownInput.value = exampleMarkdown;
    });

    clearBtn.addEventListener('click', () => {
      markdownInput.value = '';
      preview.innerHTML = '';
    });

    // Load example on page load
    window.addEventListener('DOMContentLoaded', () => {
      markdownInput.value = exampleMarkdown;
      renderMarkdown();

      // Test BottomNavigationItem parsing
      console.log("Testing BottomNavigationItem parsing...");
      const testSLML = `# Test Screen
screen:
  title: "Test Screen"

bottomNavigationBar:
  label: "Navigation"
  backgroundColor: #ffffff
  children:
    - bottomNavigationItem:
        label: "Home"
        icon: üè†
        active: true
    - bottomNavigationItem:
        label: "Search"
        icon: üîç
    - bottomNavigationItem:
        label: "Profile"
        icon: üë§
    - bottomNavigationItem:
        label: "Settings"
        icon: ‚öôÔ∏è`;

      const parsedScreen = processMarkdown(testSLML)[0];
      console.log('Parsed Screen:', parsedScreen);

      // Check if BottomNavigationBar has children
      const bottomNavBar = parsedScreen.elements.find(el => el.type.toLowerCase() === 'bottomnavigationbar');
      if (bottomNavBar && bottomNavBar.children && bottomNavBar.children.length > 0) {
        console.log('Success: BottomNavigationBar has ' + bottomNavBar.children.length + ' children');
        console.log('Children:', bottomNavBar.children);
      } else {
        console.error('Error: BottomNavigationBar has no children or is missing');
      }
    });
  </script>
</body>
</html>
